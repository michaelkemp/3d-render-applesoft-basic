
100 WIDE = 280
110 HIGH = 192
120 BIGR = 100
130 XOFF = WIDE/2
140 YOFF = HIGH/2
150 F = 4
160 XANG = 0
170 YANG = 0
180 ZANG = 0
190 HGR2: HCOLOR = 2

200 REM READ IN OBJECT
210 GOSUB 9000
250 REM SETUP SCREEN
260 GOSUB 9900

500 REM ROTATE OBJECT
510 GOSUB 4000
520 REM DRAW OBJECT
530 GOSUB 1000
540 GOSUB 9800
560 XANG = XANG + 0.044
562 YANG = YANG + 0.048
563 ZANG = ZANG + 0.052
600 GOTO 500

1000 REM DRAW OBJECT
1100 CALL 62450
1110 FOR I = 1 TO FC
1120 X1 = RO(FS(I, 1), 1)
1122 Y1 = RO(FS(I, 1), 2)
1124 Z1 = RO(FS(I, 1), 3)
1126 A1 = (F*X1) / (F-Z1)
1128 B1 = (F*Y1) / (F-Z1)
1130 X2 = RO(FS(I, 2), 1)
1132 Y2 = RO(FS(I, 2), 2)
1134 Z2 = RO(FS(I, 2), 3)
1136 A2 = (F*X2) / (F-Z2)
1138 B2 = (F*Y2) / (F-Z2)
1140 X3 = RO(FS(I, 3), 1)
1142 Y3 = RO(FS(I, 3), 2)
1144 Z3 = RO(FS(I, 3), 3)
1146 A3 = (F*X3) / (F-Z3)
1148 B3 = (F*Y3) / (F-Z3)
1160 GOSUB 2000: REM NORMAL
1180 IF SH = 0 GOTO 1500
1200 HPLOT A1*BIGR+XOFF, B1*BIGR+YOFF TO A2*BIGR+XOFF, B2*BIGR+YOFF
1210 HPLOT A2*BIGR+XOFF, B2*BIGR+YOFF TO A3*BIGR+XOFF, B3*BIGR+YOFF
1220 HPLOT A3*BIGR+XOFF, B3*BIGR+YOFF TO A1*BIGR+XOFF, B1*BIGR+YOFF
1500 NEXT I
1600 RETURN

2000 REM CALC NORMAL
2110 M0 = A2-A1
2112 M1 = B2-B1
2114 M2 = Z2-Z1
2120 N0 = A3-A2
2122 N1 = B3-B2
2124 N2 = Z3-Z2
2130 P0 = M1 * N2 - M2 * N1
2132 P1 = M2 * N0 - M0 * N2
2134 P2 = M0 * N1 - M1 * N0
2140 SH = 0
2150 IF P2 > 0 THEN SH = 1
2200 RETURN

4000 REM ROTATE OBJECT
4100 SX = SIN(XANG): CX = COS(XANG)
4102 SY = SIN(YANG): CY = COS(YANG)
4104 SZ = SIN(ZANG): CZ = COS(ZANG)
4110 FOR I = 1 TO VC
4120 X0 = VS(I, 1): Y0 = VS(I, 2): Z0 = VS(I, 3) 
4130 X1 =   1*X0 +  0*Y0 +  0*Z0
4131 Y1 =   0*X0 + CX*Y0 - SX*Z0
4132 Z1 =   0*X0 + sX*Y0 + CX*Z0
4133 X2 =  CY*X1 +  0*Y1 + SY*Z1
4134 Y2 =   0*X1 +  1*Y1 +  0*Z1
4135 Z2 = -SY*X1 +  0*Y1 + CY*Z1
4136 X3 =  CZ*X2 - SZ*Y2 +  0*Z2
4137 Y3 =  SZ*X2 + CZ*Y2 +  0*Z2
4138 Z3 =   0*X2 +  0*Y2 +  1*Z2
4140 RO(I, 1) = X3: RO(I, 2) = Y3: RO(I, 3) = Z3
4150 NEXT I
4200 RETURN


8000 REM SPHERE
8100 REM FACES - 80 TRIANGLES
8110 DATA 1,13,15,2,13,17,1,15,19,1,19,21,1,21,16,2,17,24,3,14,26,4,18,28,5,20,30
8112 DATA 6,22,32,2,24,25,3,26,27,4,28,29,5,30,31,6,32,23,7,33,39,8,34,40,9,35,41
8114 DATA 10,36,42,11,37,38,15,14,3,15,13,14,13,2,14,17,16,6,17,13,16,13,1,16,19,18
8116 DATA 4,19,15,18,15,3,18,21,20,5,21,19,20,19,4,20,16,22,6,16,21,22,21,5,22,24
8118 DATA 23,11,24,17,23,17,6,23,26,25,7,26,14,25,14,2,25,28,27,8,28,18,27,18,3,27
8120 DATA 30,29,9,30,20,29,20,4,29,32,31,10,32,22,31,22,5,31,25,33,7,25,24,33,24,11
8122 DATA 33,27,34,8,27,26,34,26,7,34,29,35,9,29,28,35,28,8,35,31,36,10,31,30,36,30
8124 DATA 9,36,23,37,11,23,32,37,32,10,37,39,38,12,39,33,38,33,11,38,40,39,12,40,34
8126 DATA 39,34,7,39,41,40,12,41,35,40,35,8,40,42,41,12,42,36,41,36,9,41,38,42,12,38
8128 DATA 37,42,37,10,42

8200 REM VERTICIES - 42
8210 DATA  0.000, -1.000,  0.000,  0.723, -0.447,  0.525, -0.276, -0.447,  0.850
8212 DATA -0.894, -0.447,  0.000, -0.276, -0.447, -0.850,  0.723, -0.447, -0.525
8214 DATA  0.276,  0.447,  0.850, -0.723,  0.447,  0.525, -0.723,  0.447, -0.525
8216 DATA  0.276,  0.447, -0.850,  0.894,  0.447,  0.000,  0.000,  1.000,  0.000
8218 DATA  0.425, -0.850,  0.309,  0.262, -0.525,  0.809, -0.162, -0.850,  0.499
8220 DATA  0.425, -0.850, -0.309,  0.850, -0.525,  0.000, -0.688, -0.525,  0.499
8222 DATA -0.525, -0.850,  0.000, -0.688, -0.525, -0.499, -0.162, -0.850, -0.499
8224 DATA  0.262, -0.525, -0.809,  0.951,  0.000, -0.309,  0.951,  0.000,  0.309
8226 DATA  0.587,  0.000,  0.809,  0.000,  0.000,  1.000, -0.587,  0.000,  0.809
8228 DATA -0.951,  0.000,  0.309, -0.951,  0.000, -0.309, -0.587,  0.000, -0.809
8230 DATA  0.000,  0.000, -1.000,  0.587,  0.000, -0.809,  0.688,  0.525,  0.499
8232 DATA -0.262,  0.525,  0.809, -0.850,  0.525,  0.000, -0.262,  0.525, -0.809
8234 DATA  0.688,  0.525, -0.499,  0.525,  0.850,  0.000,  0.162,  0.850,  0.499
8236 DATA -0.425,  0.850,  0.309, -0.425,  0.850, -0.309,  0.162,  0.850, -0.499

9000 REM SPHERE
9150 FC = 80: VC = 42
9160 DIM FS(FC,3): DIM VS(VC,3): DIM RO(VC, 3)
9180 XL = 0: XM = 0: XH = 0
9182 YL = 0: YM = 0: YH = 0
9184 ZL = 0: ZM = 0: ZH = 0
9186 SL = -0.5: SH = 0.5
9200 REM READ FACETS
9210 FOR I = 1 TO FC
9220 READ FS(I, 1): READ FS(I, 2): READ FS(I, 3)
9230 NEXT I
9300 REM READ VERTICES
9310 FOR I = 1 TO VC
9320 READ VS(I, 1): READ VS(I, 2): READ VS(I, 3)
9330 IF VS(I, 1) < XL THEN XL = VS(I, 1)
9332 IF VS(I, 1) > XH THEN XH = VS(I, 1)
9334 IF VS(I, 2) < YL THEN YL = VS(I, 2)
9336 IF VS(I, 2) > YH THEN YH = VS(I, 2)
9338 IF VS(I, 3) < ZL THEN ZL = VS(I, 3)
9340 IF VS(I, 3) > ZH THEN ZH = VS(I, 3)
9350 NEXT I
9360 XM = (XL+XH)/2
9362 YM = (YL+YH)/2
9364 ZM = (ZL+ZH)/2
9370 AL = XL
9372 IF AL > YL THEN AL = YL 
9374 IF AL > ZL THEN AL = ZL  
9380 AH = XH
9382 IF AH < YH THEN AH = YH 
9384 IF AH < ZH THEN AH = ZH  
9400 REM CENTER OBJECT
9410 FOR I = 1 TO VC
9420 X = VS(I, 1) - XM
9430 Y = VS(I, 2) - YM
9440 Z = VS(I, 3) - ZM
9450 REM SCALE OBJECT
9460 VS(I, 1) = (X - AL) * (SH - SL) / (AH - AL) + SL
9470 VS(I, 2) = (Y - AL) * (SH - SL) / (AH - AL) + SL
9480 VS(I, 3) = (Z - AL) * (SH - SL) / (AH - AL) + SL
9490 NEXT I
9500 RETURN

9800 REM SWAP SCREENS
9810 POKE 49236 + SCN,0 
9820 SCN = NOT SCN
9830 POKE 230,32 + (32 * SCN)
9840 RETURN

9900 REM HIRES, CLEAR SCREEN
9910 HGR2: HCOLOR = 3
9920 POKE 230,32: CALL 62450
9930 POKE 230,64: CALL 62450
9940 SCN = 0: POKE 49236,0: POKE 230, 32
9950 RETURN
